extends ../layouts/commits.jade

block commits-content

  block commits-navigation
    - var commitsMode = 'graph';

  noscript
    p The revision graph only works with JavaScript-enabled browsers.

  #wrapper
    ul#nodebgs
    canvas#graph(width='480', height='{canvasheight}')
    ul#graphnodes

  a.btn.btn-default(name='more', href='{url}graph/{rev}{morevars%urlparameter}#more') More Commits

  script.
    <!-- hide script content
    var data = {jsdata|json};
    var graph = new Graph();
    graph.scale({bg_height});
    graph.edge = function(x0, y0, x1, y1, color) \{
      this.setColor(color, 0.0, 0.65);
      this.ctx.beginPath();
      this.ctx.moveTo(x0, y0);
      this.ctx.lineTo(x1, y1);
      this.ctx.stroke();
    }
    var revlink = '<li style="_STYLE"><span class="desc">';
    revlink += '<a href="{url}rev/_NODEID{sessionvars%urlparameter}" title="_NODEID">_DESC</a>';
    revlink += '</span>_TAGS<span class="info">_DATE, by _USER</span></li>';
    graph.vertex = function(x, y, color, parity, cur) \{
      this.ctx.beginPath();
      color = this.setColor(color, 0.25, 0.75);
      this.ctx.arc(x, y, radius, 0, Math.PI * 2, true);
      this.ctx.fill();
      var bg = '<li class="bg parity' + parity + '"></li>';
      var left = (this.columns + 1) * this.bg_height;
      var nstyle = 'padding-left: ' + left + 'px;';
      var item = revlink.replace(/_STYLE/, nstyle);
      item = item.replace(/_PARITY/, 'parity' + parity);
      item = item.replace(/_NODEID/, cur[0]);
      item = item.replace(/_NODEID/, cur[0]);
      item = item.replace(/_DESC/, cur[3]);
      item = item.replace(/_USER/, cur[4]);
      item = item.replace(/_DATE/, cur[5]);
      var tagspan = '';
      if (cur[7].length || cur[8].length || (cur[6][0] != 'default' || cur[6][1])) \{
        tagspan = ' <span class="logtags">';
        if (cur[6][1]) \{
          tagspan += '<a class="tag branchhead" href="{url}graph/' + cur[6][0] + '" title="' + cur[6][0] + '">';
          tagspan += cur[6][0] + '</a> ';
        } else if (!cur[6][1] && cur[6][0] != 'default') \{
      tagspan += '<a class="tag branchname" href="{url}graph/' + cur[6][0] + '" title="' + cur[6][0] + '">';
      tagspan += cur[6][0] + '</a> ';
      }
      if (cur[7].length) \{
        for (var t in cur[7]) \{
          var tag = cur[7][t];
          tagspan += '<span class="tag">' + tag + '</span> ';
        }
      }
      if (cur[8].length) \{
        for (var b in cur[8]) \{
          var bookmark = cur[8][b];
          tagspan += '<span class="tag">' + bookmark + '</span> ';
        }
      }
      tagspan += '</span>';
    }
    item = item.replace(/_TAGS/, tagspan);
      return [bg, item];
    }
    graph.render(data);
    // stop hiding script -->
